<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns:css="http://macVmlSchemaUri" xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta name=Title content="">
<meta name=Keywords content="">
<meta http-equiv=Content-Type content="text/html; charset=<?php echo Zend_Registry::get('config')->charset?>">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 2008">
<meta name=Originator content="Microsoft Word 2008">


<!--[if gte mso 9]><xml>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:View>Print</w:View>
  <w:Zoom>BestFit</w:Zoom>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:DoNotHyphenateCaps/>
  <w:PunctuationKerning/>
  <w:DrawingGridHorizontalSpacing>9,35 pt</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>9,35 pt</w:DrawingGridVerticalSpacing>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:SplitPgBreakAndParaMark/>
   <w:DontVertAlignCellWithSp/>
   <w:DontBreakConstrainedForcedTables/>
   <w:DontVertAlignInTxbx/>
   <w:Word11KerningPairs/>
   <w:CachedColBalance/>
   <w:UseFELayout/>
  </w:Compatibility>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="276">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--p.MSONORMAL
	{mso-bidi-font-size:8pt;}
li.MSONORMAL
	{mso-bidi-font-size:8pt;}
div.MSONORMAL
	{mso-bidi-font-size:8pt;}
p.SMALL
	{mso-bidi-font-size:1pt;}

 /* Font Definitions */
@font-face
	{font-family:Times;
	panose-1:2 0 5 0 0 0 0 0 0 0;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:7.5pt;
	font-family:Verdana;
	mso-fareast-font-family:Verdana;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;}
p.small, li.small, div.small
	{mso-style-name:small;
	mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:1.0pt;
	font-family:Verdana;
	mso-fareast-font-family:Verdana;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->

.fail-lesson{
	background-color: #feaec9;
	color: #b55b5b;
}
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:Cambria;
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:minor-latin;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1027">
  <o:colormenu v:ext="edit" strokecolor="none"/>
 </o:shapedefaults></xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=PT style='tab-interval:36.0pt'>

	<?php $totalSchedules = count($this->schedules); ?>
	<?php $totalPersons = count($this->persons); ?>
	
	<table cellspacing="0" cellpadding="0" border="1px">
	    <colgroup><col><col><col span="<?php echo $totalSchedules;?>"></colgroup>
	    <thead>
	        <tr>
	            <td></td>				
	            <td></td>				
	            <?php foreach($this->schedules as $key => $schedule):?>				
	            <td>
	                <div style="margin:5px"><?php echo $this->escape($schedule->title)?></div>
	            </td>
	            <?php endforeach;?>				
				<td><div style="margin:5px">Итоговый текущий рейтинг</div></td>	            
				<td><div style="margin:5px">Рубежный рейтинг</div></td>	            
				<td><div style="margin:5px">Оценка</div></td>	            
	            <td><div style="margin:5px">Итог</div></td>
				<td><div style="margin:5px">Причина недопуска</div></td>	            
	        </tr>
	        <tr>
	            <th><div style="margin:5px"><?php echo _('ФИО');?></div></th>
				<th><div style="margin:5px">Учебные группы</div></th>
	            <?php foreach($this->schedules as $key => $schedule):?>	            
	            <td><?=str_replace('.', ',', $schedule->max_ball)?></td>
	            <?php endforeach;?>
	            <td></td>	            	            	            
	            <td></td>	            	            	            
	            <td></td>	            	            	            
	            <td></td>	            	            	            
	            <td></td>	            	            	            
	        </tr>
	    </thead>
	    <tbody>
	        <?php
	        $flag = 0;
	        foreach($this->persons as $key => $person):?>
			<?php
				$show_total_practic = !$this->scores[$key.'_failTotalPractic'];
				
				$isPassTotalRating  = Zend_Registry::get('serviceContainer')->getService('Lesson')->isPassTotalRating($this->additional['maxBallTotalRating'],   $this->additional['dataRatingTotal'][$key],  $this->additional['isDO'], $this->additional['is_practice']);
				$isPassMediumRating = Zend_Registry::get('serviceContainer')->getService('Lesson')->isPassMediumRating($this->additional['maxBallMediumRating'], $this->additional['dataRatingMedium'][$key], $this->additional['isDO']);
				
				# Не допущен к экзамену или сдал его ниже проходного балла.
				#$isFailSubject = empty( $this->scores[$key.'_total']['fail_message'] ) ? false : true; 
				$isPassTotalRating = empty( $this->scores[$key.'_total']['fail_message'] ) ? $isPassTotalRating : false; 
			?>
			
			
			<?php
				$fail_lessons = array(); # занятия, из-за которых недопуск к экзамену
				if(!empty($this->scores[$key.'_total']['fail_message'])){
					foreach($this->scores[$key.'_total']['fail_message'] as $mes){
						if(isset($mes['lessons'])){
							foreach($mes['lessons'] as $les_id){
								$fail_lessons[$les_id] = $les_id;
							}
						}
					}			
				}
			?>
			
			
            <?php
            $flag = !$flag;
            $color = ($flag) ? '#C9C9C9' : '#FFFFFF';
            ?>
	        <tr style="background-color:<?php echo $color;?> ">
	            <td><div style="margin:5px"><?php echo $this->escape($person->getName());?></td>
				<td><?php
					$groups = $person->studyGroups;
					if ($groups) {
						$tmp = array();
						foreach ($groups as $group) {
							$tmp [] = $group['name'];
						}
						echo implode(', ',$tmp);
					}
				?></td>
	            <?php
	            foreach($this->schedules as $schedule):?>
					<?php $fail_lesson_class = (isset($fail_lessons[$schedule->SHEID])) ? ('fail-lesson'):(''); ?>
					<?php
						if(empty($fail_lesson_class)){
							$serviceLesson = Zend_Registry::get('serviceContainer')->getService('Lesson');
							if($serviceLesson->isTotalRating($schedule)){
								if(
									$this->scores[$key.'_'.$schedule->SHEID]->V_STATUS <= 0
									||
									!$serviceLesson->isPassTotalRating($schedule->max_ball, $this->scores[$key.'_'.$schedule->SHEID]->V_STATUS)
								){
									$fail_lesson_class = 'fail-lesson';
								} 				
							}
						}					
					?>
				
	            <td class="<?=$fail_lesson_class;?>"><div style="margin:5px" >
					<?php
					if(isset($this->scores[$key.'_'.$schedule->SHEID]) && $this->scores[$key.'_'.$schedule->SHEID]->V_STATUS > -1){
						$score = $this->scores[$key.'_'.$schedule->SHEID]->V_STATUS;					
						$score = (stripos($schedule->title, 'итоговый контроль') !== false) ? round($score) : $score;
						echo str_replace('.', ',', $score);
					}					
					?>		
                    </div>
	            </div></td>
	            <?php endforeach;?>
				<td><div style="margin:5px"><?= (isset($this->additional['dataRatingMedium'][$key])) ? (str_replace('.', ',', round($this->additional['dataRatingMedium'][$key]))) : ('');?></td>
				<td><div style="margin:5px"><?= (isset($this->additional['dataRatingTotal'][$key])) ? (str_replace('.', ',', round($this->additional['dataRatingTotal'][$key]))) : ('');?></td>
				<td><div style="margin:5px">
					<?php 
						/*
						if($this->scores[$key.'_total']['mark'] !== NULL && $this->scores[$key.'_total']['mark'] >= 0 ){				
							switch ($this->scores[$key.'_total']['mark_5']) {
								case 5:
									echo _('зачтено/отлично');
									break;
								case 4:
									echo _('зачтено/хорошо');
									break;
								case 3:
									echo _('зачтено/удовлетворительно');
									break;
								case 2:
									if($this->additional['exam_type'] == HM_Subject_SubjectModel::EXAM_TYPE_TEST){
										echo _('не зачтено');		
									} else {
										echo _('неуд.');		
									}
									break;						
							}
						}
						*/
						if(
							!empty( $this->scores[$key.'_total']['fail_message'] ) 
							||
							$this->additional['dataRatingTotal'][$key] <= 0 )
						{
							echo 'н/я';
							
							
						}elseif( !$isPassTotalRating ){
							$mark_5 = 2; #Неважно, как много набрано баллов. Если завалил экзамен, в любом случае это неуд.
							echo Zend_Registry::get('serviceContainer')->getService('Lesson')->getTextFiveScaleMark($mark_5, $this->additional['exam_type']);	
							
						} else{ 
							echo Zend_Registry::get('serviceContainer')->getService('Lesson')->getTextFiveScaleMark($this->scores[$key.'_total']['mark_5'], $this->additional['exam_type']);						
						}
					?>
				</td>
	            <td><div style="margin:5px">
					<?php
						#if($this->scores[$key."_total"]['mark'] > -1) echo str_replace('.', ',', $this->scores[$key."_total"]['mark']);
						$totalScore = '';
						if(!empty( $this->scores[$key.'_total']['fail_message'] )){
							$totalScore = round($this->additional['dataRatingMedium'][$key]);							
						} elseif($this->scores[$key.'_total']['mark'] !== NULL && $this->scores[$key.'_total']['mark'] >= 0  && $isPassMediumRating && $show_total_practic){						
							$totalScore = (round($this->additional['dataRatingMedium'][$key]) + round($this->additional['dataRatingTotal'][$key]) );							
						} else {				
						}
						echo str_replace('.', ',', $totalScore);
					?>
				</div></td>
				<td><?php 
						if(!empty( $this->scores[$key.'_total']['fail_message'] )){
							foreach($this->scores[$key.'_total']['fail_message'] as $mes){								
								echo $mes['message'].'<br />';
							}
						}
				?></td>
	        </tr>
	        <?php endforeach;?>
	    </tbody>
	</table>
	
	<script type="text/javascript">
	<!--
	window.onload = function cleanPage(){ document.getElementById('ZFDebug_debug').innerHTML = '';};
	//-->
	</script>
	
	
</body>
</html>